(()=>{"use strict";var t,e={};t=e,Object.defineProperty(t,"__esModule",{value:!0}),window.MMQRMerchantBrowserSDK=class{constructor(t,e={}){if(this.ENV_URLS={sandbox:"https://sandbox.api.yourgateway.com/v1",production:"https://api.yourgateway.com/v1"},!t)throw new Error("A Publishable Key is required to initialize [MMQRMerchantSDK].");this.publishableKey=t,this.environment=e.environment||"production",e.baseUrl?this.apiBaseUrl=e.baseUrl:this.apiBaseUrl=this.ENV_URLS[this.environment],this.POLL_INTERVAL_MS=e.pollInterval||3e3,console.log(`[MMQRMerchantSDK] Initialized. Environment: ${this.environment} (URL: ${this.apiBaseUrl})`)}async _callApi(t,e={}){const n=await fetch(`${this.apiBaseUrl}${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.publishableKey}`},body:JSON.stringify(e)});if(!n.ok)throw new Error(`API error (${n.status}): ${n.statusText}`);return n.json()}async createPaymentRequest(t){try{return"sandbox"===this.environment?{success:!0,transactionId:"txn_sandbox_"+Math.random().toString(36).substring(2,9).toUpperCase(),qrCodeUrl:"https://placehold.co/200x200/90EE90/000000?text=TEST+QR",redirectUrl:"https://sandbox.yourgateway.com/test-payment"}:await this._callApi("/payment/create",t)}catch(t){return console.error("Payment request failed:",t),{success:!1,transactionId:"",qrCodeUrl:"",redirectUrl:"",error:t.message}}}async showPaymentModal(t,e,n){const o=document.getElementById(t);if(!o)throw new Error(`Container element with ID '${t}' not found.`);o.innerHTML="Initiating payment...";const r=await this.createPaymentRequest(e);if(!r.success||!r.transactionId)return o.innerHTML=`Payment Initiation Failed: ${r.error||"No transaction ID received."}`,void n({success:!1,message:r.error||"Initiation failed.",transactionId:r.transactionId||"N/A"});this._renderModal(o,r.qrCodeUrl,r.redirectUrl),this._startPolling(r.transactionId,n)}_renderModal(t,e,n){t.innerHTML=`\n      <div id="local-pay-modal" style="border: 1px solid #ccc; padding: 20px; text-align: center; max-width: 350px; margin: 20px auto; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-family: sans-serif;">\n          <h3 style="margin-top: 0; color: #333;">Scan to Pay</h3>\n          <img src="${e}" alt="QR Code" style="width: 200px; height: 200px; display: block; margin: 15px auto; border: 1px solid #eee;">\n          <p style="color: #888; font-size: 0.9em;">--- OR ---</p>\n          <a href="${n}" target="_blank" style="display: block; padding: 10px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; font-weight: bold; transition: background-color 0.2s;">\n              Click to Pay by Bank Redirect\n          </a>\n          <p style="margin-top: 15px; font-size: 0.8em; color: #aaa;">Transaction ID: ${e.match(/=(.*)/)?.[1]||"..."} | Env: ${this.environment}</p>\n          <p style="font-size: 0.9em; color: #d9534f; font-weight: bold;">Do not close this window while paying.</p>\n      </div>\n    `}async _startPolling(t,e){let n;n=window.setInterval(async()=>{try{if("sandbox"===this.environment){void 0===window._sandboxPollCount&&(window._sandboxPollCount=0),window._sandboxPollCount++;let o="PENDING";if(window._sandboxPollCount>3&&(o="COMPLETED"),"COMPLETED"===o)return window.clearInterval(n),void e({success:!0,message:"Payment confirmed!",transactionId:t});if("FAILED"===o)return window.clearInterval(n),void e({success:!1,message:`Payment ${o}.`,transactionId:t})}else{const o=(await this._callApi("/payment/status/"+t)).status.toUpperCase();if("COMPLETED"===o||"SUCCESS"===o)return window.clearInterval(n),void e({success:!0,message:"Payment confirmed!",transactionId:t});if("FAILED"===o||"EXPIRED"===o)return window.clearInterval(n),void e({success:!1,message:`Payment ${o}.`,transactionId:t})}console.log(`Polling status for ${t}: ${"sandbox"===this.environment?"PENDING (Mock)":"PENDING (Real)"}`)}catch(t){console.error("Polling error:",t)}},this.POLL_INTERVAL_MS)}},module.exports=e})();